# 轨道交通站务人员AI智能考核系统 - 研发实施技术文档

## 1. 项目概述 (Project Overview)
**项目目标**：构建一个基于 Web 的轨道交通站务人员智能考核系统。
**核心理念**：通过标签化题库管理，实现规则驱动的自动化组卷、在线考试、自动评分、员工能力画像生成，并基于数据反馈实现考核内容的动态优化（自适应考核）。
**交付形式**：Web端应用（前后端分离）。

---

## 2. 技术栈规范 (Tech Stack)

### 2.1 前端 (Frontend)
* **框架**: Vue 3 (使用 Composition API, `<script setup>` 语法)
* **构建工具**: Vite
* **UI 组件库**: Element Plus (用于后台管理布局、表单、表格)
* **数据可视化**: ECharts 5.x (用于绘制能力雷达图、趋势折线图)
* **HTTP 客户端**: Axios
* **状态管理**: Pinia (可选，视复杂度而定)

### 2.2 后端 (Backend)
* **核心框架**: Django 4.x (LTS)
* **API 框架**: Django REST Framework (DRF)
* **身份验证**: Simple JWT 或 DRF Token Authentication
* **数据库**: **SQLite 3**
    * *选择理由*: Django 原生支持，零配置，单文件存储，非常适合本项目初期开发及低成本维护。后期可无缝迁移至 PostgreSQL 或 MySQL。

---

## 3. 数据库模型设计 (Database Schema)

请在 `models.py` 中实现以下模型。所有模型应包含标准的 `created_at` 和 `updated_at` 时间戳字段。

### 3.1 用户与权限
* **User (继承 AbstractUser)**
    * `job_number` (String, Unique): 工号，作为登录凭证。
    * `position` (String): 岗位（如：值班站长、站务员）。
    * `department` (String): 所属车站/部门。

### 3.2 题库核心
* **Tag (标签)**
    * `name` (String): 标签名称（如：票务处理、火灾应急）。
    * `category` (Choice): 分类（岗位类/应急类/综合能力类）。
* **Question (题目)**
    * `content` (Text): 题目题干。
    * `question_type` (Choice): 单选 (Single) / 多选 (Multiple) / 判断 (TrueFalse)。
    * `options` (JSONField): 存储选项结构，例如 `[{"key":"A", "text":"..."}, {"key":"B", "text":"..."}]`。
    * `correct_answer` (String): 标准答案（如 "A" 或 "A,C"）。
    * `tags` (ManyToManyField -> Tag): 关联标签，支持多维标注。
    * `difficulty` (Integer): 难度系数 (1-5)。
    * `is_active` (Boolean): 软删除标记。

### 3.3 考核业务
* **ExamPaper (试卷)**
    * `user` (ForeignKey -> User): 考生。
    * `total_score` (Float): 试卷总分。
    * `score_obtained` (Float): 实际得分。
    * `status` (Choice): 未开始 / 进行中 / 已完成。
    * `generation_reason` (Choice): 日常练习 / 错题回顾 / 强制考核（预留字段）。
* **ExamRecord (答题详情)**
    * `paper` (ForeignKey -> ExamPaper): 归属试卷。
    * `question` (ForeignKey -> Question): 对应题目。
    * `user_answer` (String): 用户提交的答案。
    * `is_correct` (Boolean): 系统判定是否正确。
    * `score_gained` (Float): 该题实际得分。
    * `duration` (Integer): 答题耗时（秒）。

### 3.4 数据分析
* **CapabilityProfile (能力画像)**
    * `user` (ForeignKey -> User): 关联用户。
    * `tag` (ForeignKey -> Tag): 关联能力标签。
    * `mastery_level` (Float): 掌握度评分 (0-100)。
    * *UniqueConstraint*: `user` + `tag` 必须唯一。

### 3.5 扩展预留 (Placeholder)
* **TrainingMaterial (培训资料)**
    * *注释*: 仅建立模型框架，暂不实现具体业务逻辑。
    * `title`, `url`, `related_tags` (ManyToManyField -> Tag)。

---

## 4. 核心业务逻辑 (Core Business Logic)

### 4.1 智能组卷算法 (Service Layer)
**功能目标**：为用户生成一张包含 10-20 道题的试卷。
**算法步骤**：
1.  **输入**：`user_id`。
2.  **获取画像**：查询该用户 `CapabilityProfile` 中 `mastery_level < 60` 的标签（弱项）。
3.  **策略分配**：
    * **弱项强化 (50%)**: 优先从上述“弱项标签”的题库中随机抽取。
    * **基础巩固 (30%)**: 从其他标签中随机抽取。
    * **新题探索 (20%)**: 抽取用户从未做过的题目。
4.  **去重**：排除 `ExamRecord` 中该用户最近 24 小时内做过的题目 ID。
5.  **输出**：创建 `ExamPaper` 及对应的 `ExamRecord` (初始状态)。

### 4.2 自动评分与画像更新
**触发时机**：用户调用“提交试卷”接口时。
**处理逻辑**：
1.  **批改**：比对 `user_answer` 与 `question.correct_answer`，更新 `ExamRecord.is_correct` 和 `score_gained`。
2.  **更新画像 (加权移动平均法)**：
    * 遍历试卷中涉及的每个 `Tag`。
    * 计算本次考试该 Tag 的正确率 (`current_accuracy`)。
    * 获取数据库中该 Tag 的旧分数 (`old_score`)。
    * **新分数公式**: `new_score = (old_score * 0.7) + (current_accuracy * 100 * 0.3)`。
    * *注*：权重系数 0.7/0.3 可在 settings 中配置，目的是让能力值变化平滑，但又能体现近期表现。

---

## 5. API 接口设计 (API Endpoints)

需按照 RESTful 规范开发以下接口：

### Auth
* `POST /api/auth/login/` : 用户登录，返回 Token 和用户信息。

### Exam (考核)
* `POST /api/exam/generate/` : 触发组卷算法，返回 `paper_id`。
* `GET /api/exam/{paper_id}/` : 获取试卷详情（包含题目列表，但不含正确答案）。
* `POST /api/exam/{paper_id}/submit/` : 提交答案 JSON，后台进行判分和画像更新。
* `GET /api/exam/history/` : 获取用户的历史考试记录列表。

### Analysis (分析)
* `GET /api/analysis/radar/` : 获取当前用户的能力雷达图数据。
    * *Response Example*: `[{ "tag": "票务", "score": 85 }, { "tag": "应急", "score": 40 }]`
* `GET /api/analysis/trend/` : (可选) 获取能力变化趋势。

### Management (后台管理)
* `POST /api/upload/questions/` : 支持上传 Excel 文件批量导入题目（解析 Excel 逻辑）。

---

## 6. 前端页面规划 (Frontend Requirements)

### 6.1 登录页 (Login View)
* 简单的表单：工号、密码。

### 6.2 个人工作台 (Dashboard)
* **顶部**：用户信息卡片。
* **左侧/中心**：能力雷达图 (ECharts)，直观展示当前强弱项。
* **操作区**：大按钮“开始每日考核”。
* **列表区**：最近 5 次考核成绩记录。

### 6.3 答题界面 (Exam Taking View)
* **模式**：建议采用“单题卡片式”或“左侧题目列表/右侧详情”布局。
* **功能**：
    * 倒计时组件。
    * 选项点击（支持单选/多选交互）。
    * 提交确认弹窗。

### 6.4 考后分析 (Result View)
* 展示本次得分。
* **错题解析**：列表展示答错的题目，标记出“您的答案”与“正确答案”。
* **建议模块**：根据本次更新的画像，显示提示语（如：“您的[火灾应急]能力急需提升”）。