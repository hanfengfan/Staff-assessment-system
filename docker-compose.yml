version: '3.8'

services:
  # === Django 后端服务 ===
  backend:
    build: ./backend             # 告诉它去 backend 目录找 Dockerfile
    container_name: my_django_container
    restart: always
    ports:
      # 【关键】只允许本机访问 8081，防止外网直接穿透，保护已有项目
      - "127.0.0.1:8081:8000"
    volumes:
      # - ./backend:/app           # 挂载代码，方便后续修改代码不用重做镜像
      
      # ✅ [新增] 只挂载需要保存数据的“单文件”或“特定目录”
      # 这样代码会使用镜像里的最新版，而数据库会读写服务器上的文件
      - ./backend/db.sqlite3:/app/db.sqlite3
      
      # (可选) 如果您的项目有上传文件功能，需要解开下面的注释
      # - ./backend/media:/app/media
      
      # (可选) 静态文件目录
      # - ./backend/static:/app/static

  # === Vue 前端服务 ===
  frontend:
    build: ./frontend            # 告诉它去 frontend 目录找 Dockerfile
    container_name: my_vue_container
    restart: always
    ports:
      # 【关键】只允许本机访问 8082
      - "127.0.0.1:8082:80"
    depends_on:
      - backend                  # 确保后端先启动